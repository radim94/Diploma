(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     12651,        303]
NotebookOptionsPosition[     11646,        270]
NotebookOutlinePosition[     12097,        287]
CellTagsIndexPosition[     12054,        284]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IMGRead", "[", 
    RowBox[{"fileName_", ",", "readSize_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"imgBin", ",", 
       RowBox[{"xC", "=", 
        RowBox[{"readSize", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", 
       RowBox[{"yC", "=", 
        RowBox[{"readSize", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ",", 
       RowBox[{"zC", "=", 
        RowBox[{"readSize", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"imgBin", "=", 
       RowBox[{"BinaryReadList", "[", "fileName", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"imgBin", "=", 
         RowBox[{"Partition", "[", 
          RowBox[{
           RowBox[{"imgBin", "[", 
            RowBox[{"[", 
             RowBox[{"513", ";;"}], "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"512", "*", "500"}], "+", "40"}]}], "]"}]}], ";"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"imgBin", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"imgBin", "[", 
          RowBox[{"[", 
           RowBox[{"xC", ";;"}], "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"zC", "*", "yC"}], "+", "40"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"imgBin", "=", 
       RowBox[{"Drop", "[", 
        RowBox[{"imgBin", ",", "0", ",", "40"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"imgBin", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"imgBin", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "zC"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"imgBin", "=", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"imgBin", ",", 
          RowBox[{"{", 
           RowBox[{"{", "3", "}"}], "}"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "imgBin", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.537026778351465*^9, 3.537026781460764*^9}, {
   3.537027147096095*^9, 3.5370271867811213`*^9}, {3.537027219839321*^9, 
   3.537027291852829*^9}, {3.5370273332210913`*^9, 3.5370273556610193`*^9}, 
   3.5370274085415897`*^9, 3.537027456525734*^9, {3.708252844840946*^9, 
   3.7082528643530617`*^9}, 3.7082533966598463`*^9, 3.708253473684821*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IMG2TIFF", "[", 
    RowBox[{"IMGFileName_", ",", "TIFFFileName_", ",", "imgSize_"}], "]"}], ":=",
    "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"img3DBin", ",", "imgs"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"img3DBin", "=", 
       RowBox[{"IMGRead", "[", 
        RowBox[{"IMGFileName", ",", "imgSize"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"imgs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Image", "[", 
          RowBox[{
           RowBox[{"img3DBin", "[", 
            RowBox[{"[", 
             RowBox[{"#", ",", "All", ",", "All"}], "]"}], "]"}], ",", 
           "\"\<Byte\>\""}], "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"imgSize", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"TIFFFileName", ",", "imgs", ",", 
        RowBox[{"\"\<ImageEncoding\>\"", "\[Rule]", "None"}]}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.537030039073658*^9, 3.537030207734597*^9}, {
   3.537030238786944*^9, 3.5370302482177267`*^9}, {3.58796966855247*^9, 
   3.587969671706853*^9}, {3.708253224942478*^9, 3.7082532294244843`*^9}, 
   3.7082534599997983`*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"fileName", "=", 
  RowBox[{"SystemDialogInput", "[", 
   RowBox[{"\"\<FileOpen\>\"", ",", 
    RowBox[{"{", 
     RowBox[{"\"\<\>\"", ",", 
      RowBox[{"{", 
       RowBox[{"\"\<SD-OCT 3D files (*.img)\>\"", "\[Rule]", 
        RowBox[{"{", "\"\<*.img\>\"", "}"}]}], "}"}]}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"outName", "=", 
  RowBox[{"SystemDialogInput", "[", 
   RowBox[{"\"\<FileSave\>\"", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"DirectoryName", "[", "fileName", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<Multislice Images (*.tif, *.tiff)\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<*.tif\>\"", ",", "\"\<*.tiff\>\""}], "}"}]}], "}"}]}], 
     "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.587966572748097*^9, 3.587966574705235*^9}}],

Cell[BoxData["\<\"D:\\\\OCTImageProcessing\\\\\:041d\:043e\:0432\:044b\:0435 \
\:043e\:0431\:0440\:0430\:0437\:0446\:044b \
2\\\\\:0421\:0443\:0445\:043e\:0432 352252 \:0437\:0434\:043e\:0440\:043e\
\:0432\:043e\:0435\\\\\:0417\:0434\:043e\:0440\:043e\:0432\:043e\:0435.img\"\>\
"], "Output",
 CellChangeTimes->{
  3.587966582199502*^9, 3.5879670877945213`*^9, 3.587968803301589*^9, 
   3.587969723854988*^9, 3.7082524587707777`*^9, 3.708253158696229*^9, 
   3.7082532367955008`*^9, 3.708253407175867*^9, 3.708253482671839*^9, 
   3.708253770788548*^9, 3.7082543547245364`*^9, 3.708254566320097*^9, 
   3.7082546942253275`*^9, 3.7082548063985777`*^9, 3.70825491682636*^9, 
   3.7082550318445215`*^9, 3.708255343230959*^9, 3.7082554824811535`*^9, 
   3.7082555587412605`*^9, 3.7083028208662615`*^9, 3.708302901136374*^9, 
   3.708303003880519*^9, 3.7083031079926653`*^9, 3.7083032315988407`*^9, 
   3.708303304158942*^9, 3.708303438841132*^9, 3.7083039145297985`*^9, {
   3.708304062376006*^9, 3.7083040777260275`*^9}, 3.7083043623924274`*^9, 
   3.7083045487186885`*^9, 3.7083048519151134`*^9, 3.7083049657712736`*^9, 
   3.7083052257877913`*^9, 3.7083053616139827`*^9, 3.708312143190351*^9, 
   3.7083122730727797`*^9, 3.7083124896051645`*^9, 3.708313227607376*^9, 
   3.7083137359586806`*^9, 3.708314340667452*^9, 3.70831457732351*^9, 
   3.7083146557806487`*^9, 3.7083149464347725`*^9, 3.708315250877662*^9, 
   3.7083155610107927`*^9, 3.708315958093919*^9, 3.708316420211082*^9, 
   3.7083165304487457`*^9, 3.708316624239889*^9, 3.7083176931969614`*^9, 
   3.708317856595192*^9, 3.708318091005521*^9, {3.708318771852913*^9, 
   3.7083188137023067`*^9}}],

Cell[BoxData["\<\"D:\\\\OCTImageProcessing\\\\\:041d\:043e\:0432\:044b\:0435 \
\:043e\:0431\:0440\:0430\:0437\:0446\:044b \
2\\\\\:0421\:0443\:0445\:043e\:0432 352252 \:0437\:0434\:043e\:0440\:043e\
\:0432\:043e\:0435\\\\B.tif\"\>"], "Output",
 CellChangeTimes->{
  3.587966582199502*^9, 3.5879670877945213`*^9, 3.587968803301589*^9, 
   3.587969723854988*^9, 3.7082524587707777`*^9, 3.708253158696229*^9, 
   3.7082532367955008`*^9, 3.708253407175867*^9, 3.708253482671839*^9, 
   3.708253770788548*^9, 3.7082543547245364`*^9, 3.708254566320097*^9, 
   3.7082546942253275`*^9, 3.7082548063985777`*^9, 3.70825491682636*^9, 
   3.7082550318445215`*^9, 3.708255343230959*^9, 3.7082554824811535`*^9, 
   3.7082555587412605`*^9, 3.7083028208662615`*^9, 3.708302901136374*^9, 
   3.708303003880519*^9, 3.7083031079926653`*^9, 3.7083032315988407`*^9, 
   3.708303304158942*^9, 3.708303438841132*^9, 3.7083039145297985`*^9, {
   3.708304062376006*^9, 3.7083040777260275`*^9}, 3.7083043623924274`*^9, 
   3.7083045487186885`*^9, 3.7083048519151134`*^9, 3.7083049657712736`*^9, 
   3.7083052257877913`*^9, 3.7083053616139827`*^9, 3.708312143190351*^9, 
   3.7083122730727797`*^9, 3.7083124896051645`*^9, 3.708313227607376*^9, 
   3.7083137359586806`*^9, 3.708314340667452*^9, 3.70831457732351*^9, 
   3.7083146557806487`*^9, 3.7083149464347725`*^9, 3.708315250877662*^9, 
   3.7083155610107927`*^9, 3.708315958093919*^9, 3.708316420211082*^9, 
   3.7083165304487457`*^9, 3.708316624239889*^9, 3.7083176931969614`*^9, 
   3.708317856595192*^9, 3.708318091005521*^9, {3.708318771852913*^9, 
   3.70831881917662*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"IMG2TIFF", "[", 
  RowBox[{"fileName", ",", "outName", ",", 
   RowBox[{"{", 
    RowBox[{"500", ",", "500", ",", "512"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.537030361671546*^9, 3.537030390568184*^9}, {
   3.53743170414994*^9, 3.5374317172856493`*^9}, {3.58796637501729*^9, 
   3.587966392871151*^9}, {3.587967060784068*^9, 3.587967063547859*^9}, {
   3.5879676039832487`*^9, 3.587967604300233*^9}, {3.587968464374921*^9, 
   3.5879684646634493`*^9}, {3.7082524247097135`*^9, 
   3.7082524282777214`*^9}, {3.7082531311381807`*^9, 
   3.7082531319281816`*^9}, {3.708253746214693*^9, 3.708253747564695*^9}, {
   3.708254342214509*^9, 3.708254342877511*^9}, {3.7082545569090824`*^9, 
   3.7082545573610835`*^9}, {3.708254683825308*^9, 3.708254684005308*^9}, {
   3.708254907376347*^9, 3.7082549078963475`*^9}, {3.708255020324506*^9, 
   3.708255021374507*^9}, {3.708255332350943*^9, 3.7082553329709444`*^9}, 
   3.708255474981143*^9, 3.70825555099125*^9, {3.7083028102362466`*^9, 
   3.708302811196248*^9}, {3.708302991810502*^9, 3.7083029920005026`*^9}, {
   3.708303297798933*^9, 3.7083032991089354`*^9}, {3.708304069806017*^9, 
   3.7083040703660173`*^9}, {3.7083048393250957`*^9, 
   3.7083048400850964`*^9}, {3.708305351193968*^9, 3.7083053524139695`*^9}, {
   3.708312128034484*^9, 3.708312128706523*^9}, {3.7083122596790137`*^9, 
   3.708312261252104*^9}, {3.7083131861230035`*^9, 3.7083131879811096`*^9}, {
   3.7083137258041*^9, 3.708313726257126*^9}, 3.7083143349634433`*^9, {
   3.7083145599924836`*^9, 3.7083145606824846`*^9}, {3.708314927812243*^9, 
   3.7083149367867565`*^9}, 3.708316399133052*^9, 3.708316522405734*^9, {
   3.708316615655377*^9, 3.708316615845377*^9}, {3.7083178474251795`*^9, 
   3.70831784805518*^9}, {3.708318785585699*^9, 3.7083187865677547`*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.560144596808312*^9, 3.560144624052796*^9}, {
   3.587967656206723*^9, 3.587967656449686*^9}, 3.708252422296709*^9}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.5879652965631733`*^9, 3.587965315406073*^9}, {
   3.587965727286927*^9, 3.587965887023885*^9}, 3.58796635678165*^9, {
   3.587967686676161*^9, 3.58796768840165*^9}, 3.70825241330268*^9}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7082524114616632`*^9, 3.7082524114716635`*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.708252410385645*^9, 3.708252410435645*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.7082524093826427`*^9}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.708252408251641*^9}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.708252407070639*^9}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.708252405846635*^9}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{3.7082524041916313`*^9}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.587967402151449*^9, 3.58796741414142*^9}, 
   3.7082524025056252`*^9}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7082524005906224`*^9, 3.708252400600622*^9}}]
},
WindowToolbars->"EditBar",
WindowSize->{1920, 998},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
PrivateNotebookOptions->{"VersionedStylesheet"->{"Default.nb"[8.] -> False}},
FrontEndVersion->"10.0 for Microsoft Windows (64-bit) (December 4, 2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 2555, 68, 232, "Input"],
Cell[3115, 90, 1391, 35, 132, "Input"],
Cell[CellGroupData[{
Cell[4531, 129, 833, 21, 52, "Input"],
Cell[5367, 152, 1657, 24, 31, "Output"],
Cell[7027, 178, 1605, 23, 31, "Output"]
}, Open  ]],
Cell[8647, 204, 1818, 27, 31, "Input"],
Cell[10468, 233, 164, 2, 31, "Input"],
Cell[10635, 237, 235, 3, 31, "Input"],
Cell[10873, 242, 96, 1, 31, "Input"],
Cell[10972, 245, 92, 1, 31, "Input"],
Cell[11067, 248, 70, 1, 31, "Input"],
Cell[11140, 251, 68, 1, 31, "Input"],
Cell[11211, 254, 68, 1, 31, "Input"],
Cell[11282, 257, 68, 1, 31, "Input"],
Cell[11353, 260, 70, 1, 31, "Input"],
Cell[11426, 263, 119, 2, 31, "Input"],
Cell[11548, 267, 94, 1, 64, "Input"]
}
]
*)

(* End of internal cache information *)
